<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>#My_Goal_Tracker</title>
  <style>
    /* All CSS remains the same as before (you can keep it as is) */
    /* Just update the title + dark mode support if needed */
  </style>
</head>
<body>

  <h1>#My_Goal_Tracker</h1>

  <label class="toggle-container" title="Toggle Dark Mode">
    <span class="toggle-label">Dark Mode</span>
    <input type="checkbox" id="darkModeToggle" />
  </label>

  <div class="event-list" id="goalList">Loading goals...</div>

  <div class="quote-container" id="quoteContainer">
    Loading motivational quote...
  </div>

  <script>
    const goalList = document.getElementById('goalList');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const quoteContainer = document.getElementById('quoteContainer');

    let countdowns = [];

    function applyTheme(isDark) {
      document.body.classList.toggle('dark', isDark);
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    applyTheme(localStorage.getItem('theme') === 'dark');
    darkModeToggle.checked = document.body.classList.contains('dark');

    darkModeToggle.addEventListener('change', () => {
      applyTheme(darkModeToggle.checked);
    });

    function formatTimeDiff(diffMs) {
      const isPast = diffMs < 0;
      const absMs = Math.abs(diffMs);
      const days = Math.floor(absMs / (1000 * 60 * 60 * 24));
      const hours = Math.floor((absMs / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((absMs / (1000 * 60)) % 60);
      const seconds = Math.floor((absMs / 1000) % 60);
      return `${isPast ? '-' : ''}${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    function createCountdown(goal) {
      const now = new Date();
      const goalDate = new Date(goal.date);
      const totalDuration = goalDate - goal.startDate;
      const timeDiff = goalDate - now;

      goal.timerElement.textContent = formatTimeDiff(timeDiff);

      // Color and progress logic
      const elapsed = now - goal.startDate;
      let percent = (elapsed / totalDuration) * 100;
      percent = Math.min(Math.max(percent, 0), 100);
      goal.progressBar.style.width = percent + "%";

      // Remove old tile colors
      goal.cardElement.classList.remove("tile-green", "tile-yellow", "tile-red", "ended");

      const timeLeftPercent = 100 - percent;

      if (timeDiff < 0) {
        goal.cardElement.classList.add("ended");
      } else if (timeLeftPercent > 66) {
        goal.cardElement.classList.add("tile-green");
      } else if (timeLeftPercent > 33) {
        goal.cardElement.classList.add("tile-yellow");
      } else {
        goal.cardElement.classList.add("tile-red");
      }
    }

    async function loadGoals() {
      try {
        const response = await fetch('./goals.json'); // renamed from events.json
        const goals = await response.json();
        goalList.innerHTML = '';
        const now = new Date();

        countdowns = goals.map(goal => {
          const card = document.createElement('div');
          card.className = 'event-card';

          const title = document.createElement('h3');
          title.textContent = goal.name;

          const desc = document.createElement('div');
          desc.className = 'desc';
          desc.textContent = goal.description || '';

          const timer = document.createElement('div');
          timer.className = 'timer';

          const progressContainer = document.createElement('div');
          progressContainer.className = 'progress-container';
          const progressBar = document.createElement('div');
          progressBar.className = 'progress-bar';
          progressContainer.appendChild(progressBar);

          card.appendChild(title);
          if (goal.description) card.appendChild(desc);
          card.appendChild(timer);
          card.appendChild(progressContainer);

          goalList.appendChild(card);

          return {
            date: goal.date,
            startDate: goal.startDate ? new Date(goal.startDate) : now,
            cardElement: card,
            timerElement: timer,
            progressBar: progressBar
          };
        });

        countdowns.forEach(createCountdown);
        setInterval(() => countdowns.forEach(createCountdown), 1000);

      } catch (err) {
        goalList.textContent = 'Error loading goals. Check goals.json file.';
        console.error(err);
      }
    }

    const quotes = [
      "The best way to get started is to quit talking and begin doing. – Walt Disney",
      "Don’t let yesterday take up too much of today. – Will Rogers",
      "It’s not whether you get knocked down, it’s whether you get up. – Vince Lombardi",
      "If you are working on something exciting, it will keep you motivated. – Elon Musk",
      "Success is not in what you have, but who you are. – Bo Bennett",
      "The harder you work for something, the greater you’ll feel when you achieve it.",
      "Dream it. Wish it. Do it.",
      "Stay positive, work hard, make it happen."
    ];

    function showRandomQuote() {
      const idx = Math.floor(Math.random() * quotes.length);
      quoteContainer.textContent = quotes[idx];
    }

    showRandomQuote();
    loadGoals();
  </script>

</body>
</html>
